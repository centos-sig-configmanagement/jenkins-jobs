- builder:
    name: rpm-build
    builders:
      - scratch-build-rpm:
         name: '{name}'
         buildtarget: '{buildtarget}'
      - build-candidate-rpm:
         name: '{name}'
         buildtarget: '{buildtarget}'

- builder:
    name: scratch-build-rpm
    builders:
      - shell: |
          #!/bin/bash -e
          # Ensure we do not expose secrets
          set +x
          set -o pipefail
          cbs build --wait --scratch {buildtarget} *.src.rpm
          rm *.src.rpm

- builder:
    name: build-candidate-rpm
    builders:
      - shell: |
          #!/bin/bash -e
          # Ensure we do not expose secrets
          set +x
          set -o pipefail
          cbs build --wait {buildtarget} *.src.rpm

- builder:
    name: allow-package-on-buildtag
    builders:
      - shell: |
          #!/bin/bash -e
          # Ensure we do not expose secrets
          set +x
          # Return true ; if this is not working, the next step will fail anyway
          cbs add-pkg --owner roidelapluie {buildtag}-candidate {name} || true

