- builder:
    name: rpm-group
    builders:
      - scratch-build:
          name: '{name}'
          buildtarget: '{buildtarget}'
      - build-candidate:
          name: '{name}'
          buildtarget: '{buildtarget}'
          buildtag: '{buildtag}'
      - test-candidate:
          name: '{name}'
          buildtag: '{buildtag}'

- builder:
    name: scratch-build
    builders:
      - bootstrap-duffy-node-for-rpm-build:
      - build-srpm:
          specfile: '{name}.spec'
      - get-srpm:
      - free-duffy-node:
      - scratch-build-rpm:
          buildtarget: '{buildtarget}'

- builder:
    name: build-candidate
    builders:
      - transform-spec-file:
          specfile: '{name}.spec'
          name: '{name}'
      - bootstrap-duffy-node-for-rpm-build:
      - build-srpm:
          specfile: '{name}.spec'
      - get-srpm:
      - free-duffy-node:
      - allow-package-on-buildtag:
          name: '{name}'
          buildtag: '{buildtag}'
      - build-candidate-rpm:
          buildtarget: '{buildtarget}'

- builders:
    name: test-candidate
    steps:
      - bootstrap-duffy-node-for-acceptance-test:
      - free-duffy-node:
