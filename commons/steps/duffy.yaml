# https://github.com/almighty/almighty-jobs
- builder:
    name: bootstrap-duffy-node
    builders:
      - shell: |
          set +e
          set +x
          export CICO_API_KEY=$(cat ~/duffy.key )
          read CICO_hostname CICO_ssid <<< $(cico node get -f value -c ip_address -c comment)
          sshopts="-t -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -l root"
          ssh_cmd="ssh $sshopts $CICO_hostname"
          env > jenkins-env
          $ssh_cmd yum -y install {packages}

- builder:
    name: free-duffy-node
    builders:
      - shell: |
          set +e
          set +x
          source jenkins-env
          cico node done $CICO_ssid
          exit $rtn_code
