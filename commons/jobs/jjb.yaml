- job:
    name: 'sig-configmanagement-jjb'
    display-name: 'Config Management SIG / Job Builder'
    node: sig-configmanagement
    logrotate:
      numToKeep: 15
    parameters:
      - string:
          name: sha1
          default: master
    properties:
      - github:
          url: https://github.com/centos-sig-configmanagement/jenkins-jobs
    scm:
      - git:
            refspec: +refs/heads/*:refs/remotes/origin/* +refs/pull/*:refs/remotes/origin/pr/*
            url: https://github.com/centos-sig-configmanagement/jenkins-jobs
            branches:
              - '${sha1}'
    triggers:
      - github:
      - githubprb:
          admins:
            - roidelapluie
            - hguemar
            - fcami
    publishers:
      - github-notifier
    builders:
      - shell: |
          #!/bin/bash -e
          # Ensure we do not expose secrets
          set +x
          set -o pipefail
          ./ci/test.sh
          if [[ ${sha1} == master ]]
          then
            ./ci/publish.sh
          fi

